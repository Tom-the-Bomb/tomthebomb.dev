---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";

import BaseLayout from "../../layouts/BaseLayout.astro";
import { getAlbumImages } from "../../utils";

export async function getStaticPaths() {
    const albums = await getCollection("albums");

    return Object.values(albums).map((album) => (
        {
            params: {
                id: album.id,
            },
            props: {
                album,
            },
        }
    ));
}

const { album } = Astro.props;
const images = await getAlbumImages(album.id);
---
<style>
.modal {
    width: 100%;
    height: 100%;
    position: fixed;
    top: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: rgba(0, 0, 0, 0.733);
    margin-top: -1px;
    animation: zoom 0.3s ease-in-out;
}
@keyframes zoom {
    from {
        transform: scale(0);
    }
    to {
        transform: scale(1);
    }
}
.modal img {
    width: 50%;
    object-fit: cover;
}
</style>

<BaseLayout>
    <div class="flex flex-col flex-wrap gap-3 text-center">
        <h1 class="text-4xl font-extrabold drop-shadow-lg">
            {album.data.title}
        </h1>
        <p class="text-md opacity-75 font-sans">
            {album.data.description}
        </p>
        <div class="mx-auto container my-8 sm:columns-2 md:columns-3 lg:columns-4 xl:columns-5">
            {
                images.map((image) => (
                    <Image
                        data-gallery-image
                        src={image}
                        alt="test"
                        class={
                            `rounded-md mb-4 shadow-lg hover:scale-[102%] opacity-90
                            border border-transparent hover:border-gray-100
                            transition-all duration-300 ease-in-out`
                        }
                        format="avif"
                        quality={50}
                        loading="lazy"
                        decoding="async"
                        data-album-image
                    />
                ))
            }
        </div>
    </div>
</BaseLayout>

<script>
    const images = document.querySelectorAll('[data-gallery-image]')

    images?.forEach((image) => {
        image.addEventListener('click', (event) => {
            console.log(1);
            const src = (event.target as HTMLImageElement).src;
            console.log(src);

            const modal = document.createElement("div");
            modal.setAttribute("class", "modal");
            //add the modal to the main section or the parent element
            document.querySelector(".main")?.append(modal);
            //adding image to modal
            const newImage = document.createElement("img");
            newImage.setAttribute("src", src);
            //creating the close button
            const closeBtn = document.createElement("i");
            closeBtn.setAttribute("class", "fas fa-times closeBtn");
            //close function
            closeBtn.onclick = () => {
                modal.remove();
            };
            modal.append(newImage, closeBtn);
        })
    });
</script>